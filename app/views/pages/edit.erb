
<% form_for @page do |f| %>

  <table class="page-head">
    <tr>
      <td style="width:230px;">
        <%= f.label "Page Name" %> <span class="star_req">*</span>
        <%= f.text_field :name, {:rel => 'text_req', :style => 'width:130px' } %>
      </td>
      <td style="width:250px;">
        <%= f.label 'FB Page/Profile ID' %> <span class="star_req">*</span>
        <%= f.text_field :fb_sig_page_id, {:rel => 'text_req', :style => 'width:120px' } %>
      </td>
      <td style="width:120px;">
        <%= f.label :publish %>
        <%= f.check_box(:publish) %> (yes)
      </td>
      <td class="buttons" style="width:140px;">
        <%= link_to 'Facebook Preview', 'http://apps.facebook.com/aplanofattack/deploy/preview/' + @page.preview_key, {:target => '_blank', :class => 'positive', :style => 'float:right; position:relative;'} %>
      </td>
      <td class="buttons" style="width:120px;">
        <button id="save-page" type="submit" class="positive" style="float:right">Save Page</button>
      </td>
    </tr>
  </table>
  <%= f.text_area :body, :style => 'display:none' %>
  <%= f.text_area :css, :style => 'display:none' %>
<% end %>
      
  <ul id="page-tabs">
    <li title="View the latest rendered output of your page"><a href="#" rel="tab-view" id="reload-iframe">View Page</a></li>
    <li title="Edit the contents of your page"><a href="#body" rel="tab-body">Body</a></li>
    <li title="Edit the CSS of your main page"><a href="#css" rel="tab-css">CSS</a></li>
    <li title="Configure widgets to add to your page"><a href="#widget" rel="tab-widget">Widgets</a></li>
  </ul>

  <div id="main" rel="<%= @page.id %>">
    <div id="content">

      <div id="tab-view" class="tab-content">
        <div style="text-align:right">
          <%= link_to '[Delete this page!]', page_path(@page), :class => 'delete', :rel => 'pages' %>
        </div>
        <iframe id="page-iframe" src ="/deploy/preview/<%= @page.preview_key %>" width="100%" height="800px">Iframe not Supported</iframe>
      </div>
        
      <div id="tab-body" class="tab-content">
        <div class="notes">
          Make sure your code is valid XHTML. Facebook is pretty strict.
          Be sure to use the "Facebook Preview" button to ensure your code works in Facebook.
          <br/>Javascript is not allowed and will be stripped out. Use the "Widgets" tab to create advanced interactions using javascript.
        </div>
        <textarea id="page_body_helper"></textarea>
      </div>
     
      <div id="tab-css" class="tab-content">
        <div class="notes">
          Add custom CSS here. Note that much of CSS3 is not allowed in facebook but will work in your preview.
          If your code is not working, the CSS is probably invalid.
        </div>
        <textarea id="page_css_helper"></textarea>
      </div>

      <div id="tab-widget" class="tab-content">
        <div style="padding:5px;background:#ffffcc;overflow:hidden;">
          <h3 style="float:left; margin-right:10px;">My Slideshows</h3>
          <select id="sliders-list" class="widget-list" style="float:left; margin-right:10px;">
            <option value="0">Select a Slideshow</option>
          <% @page.sliders.each do |slider| %>
            <option value="<%=edit_slider_path(slider)%>">
              <%= slider.name %> [#slider:<%=slider.id%>]
            </option>
          <% end %>
          </select>
          <%= link_to 'New Slideshow', new_page_slider_path(@page), :rel => 'facebox', :style => 'float:left' %>
        </div>
        <div style="margin-bottom:10px; padding:3px;background:#ddf9bc;font-weight:bold; color:#000; text-align:center">
          Add a widget to your page by pasting the widget's <b>TOKEN</b> into your page body. An example TOKEN: [#slider:1]
        </div>        
        <div id="widget-wrapper"></div>
      </div>
      
    </div>
  </div>

